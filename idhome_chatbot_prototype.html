<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ  Chatbot UI ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
/* â”€â”€ ã‚µã‚¤ãƒˆèƒŒæ™¯ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰ â”€â”€ */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Noto Sans JP', sans-serif;
  background: #f5f4f0;
  min-height: 100vh;
  overflow-x: hidden;
}

.site-bg {
  min-height: 100vh;
  background: linear-gradient(160deg, #0a1628 0%, #12264a 40%, #1a3a6a 100%);
  position: relative;
  display: flex;
  flex-direction: column;
}

/* ãƒ€ãƒŸãƒ¼ãƒŠãƒ“ */
.dummy-nav {
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding: 18px 48px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.dummy-logo {
  color: white;
  font-size: 20px;
  font-weight: 700;
  letter-spacing: 2px;
}
.dummy-logo span { color: #e8a020; }
.dummy-nav-links {
  display: flex;
  gap: 32px;
  list-style: none;
}
.dummy-nav-links li a {
  color: rgba(255,255,255,0.65);
  text-decoration: none;
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 1px;
  transition: color 0.2s;
}
.dummy-hero {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  padding: 80px 40px;
  color: white;
}
.dummy-hero h1 {
  font-size: clamp(28px, 4vw, 52px);
  font-weight: 900;
  line-height: 1.2;
  margin-bottom: 16px;
}
.dummy-hero h1 span { color: #e8a020; }
.dummy-hero p {
  font-size: 16px;
  color: rgba(255,255,255,0.6);
  max-width: 480px;
  line-height: 1.8;
  margin-bottom: 32px;
}
.dummy-btn {
  background: #e8a020;
  color: #0a1628;
  border: none;
  padding: 14px 36px;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
}
.prototype-label {
  position: fixed;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(232,160,32,0.95);
  color: #0a1628;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 2px;
  padding: 6px 20px;
  border-radius: 20px;
  z-index: 10000;
  white-space: nowrap;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHATBOT BUBBLE BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chat-bubble-btn {
  position: fixed;
  bottom: 28px;
  right: 28px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #0a1628;
  border: 2.5px solid #e8a020;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.35), 0 0 0 0 rgba(232,160,32,0.4);
  z-index: 9000;
  transition: transform 0.2s, box-shadow 0.2s;
  animation: pulse-ring 2.5s ease-out infinite;
}
.chat-bubble-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 6px 28px rgba(0,0,0,0.45), 0 0 0 6px rgba(232,160,32,0.15);
}
.chat-bubble-btn svg {
  width: 26px;
  height: 26px;
  fill: #e8a020;
  transition: transform 0.3s;
}
.chat-bubble-btn.open svg { transform: rotate(90deg); }

@keyframes pulse-ring {
  0% { box-shadow: 0 4px 20px rgba(0,0,0,0.35), 0 0 0 0 rgba(232,160,32,0.4); }
  60% { box-shadow: 0 4px 20px rgba(0,0,0,0.35), 0 0 0 14px rgba(232,160,32,0); }
  100% { box-shadow: 0 4px 20px rgba(0,0,0,0.35), 0 0 0 0 rgba(232,160,32,0); }
}

/* æœªèª­ãƒãƒƒã‚¸ */
.chat-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  width: 18px;
  height: 18px;
  background: #e84040;
  border-radius: 50%;
  border: 2px solid white;
  font-size: 9px;
  font-weight: 700;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s;
}
.chat-badge.hidden { opacity: 0; pointer-events: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHAT WINDOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chat-window {
  position: fixed;
  bottom: 100px;
  right: 28px;
  width: 380px;
  height: 580px;
  background: #ffffff;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.25), 0 4px 16px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 8999;
  transform: scale(0.85) translateY(24px);
  opacity: 0;
  pointer-events: none;
  transform-origin: bottom right;
  transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), opacity 0.25s ease;
}
.chat-window.open {
  transform: scale(1) translateY(0);
  opacity: 1;
  pointer-events: all;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.chat-header {
  background: linear-gradient(135deg, #0a1628 0%, #1a3a6a 100%);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}
.chat-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #e8a020;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
  position: relative;
}
.chat-avatar::after {
  content: '';
  position: absolute;
  bottom: 1px;
  right: 1px;
  width: 10px;
  height: 10px;
  background: #2ecc71;
  border-radius: 50%;
  border: 2px solid #0a1628;
}
.chat-header-info { flex: 1; }
.chat-header-name {
  font-size: 14px;
  font-weight: 700;
  color: white;
  line-height: 1.2;
}
.chat-header-status {
  font-size: 11px;
  color: rgba(255,255,255,0.55);
  margin-top: 2px;
}
.chat-close-btn {
  background: rgba(255,255,255,0.1);
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgba(255,255,255,0.7);
  font-size: 16px;
  transition: background 0.2s;
  flex-shrink: 0;
}
.chat-close-btn:hover { background: rgba(255,255,255,0.2); color: white; }

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px 16px 8px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  background: #f8f7f4;
  scroll-behavior: smooth;
}
.chat-messages::-webkit-scrollbar { width: 4px; }
.chat-messages::-webkit-scrollbar-track { background: transparent; }
.chat-messages::-webkit-scrollbar-thumb { background: #d0ccc5; border-radius: 4px; }

/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ–ãƒ« */
.msg {
  display: flex;
  gap: 8px;
  align-items: flex-end;
  animation: msg-in 0.25s ease both;
}
@keyframes msg-in {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}
.msg.user { flex-direction: row-reverse; }
.msg-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: #e8a020;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  flex-shrink: 0;
  margin-bottom: 2px;
}
.msg.user .msg-avatar { background: #1a3a6a; }
.msg-bubble {
  max-width: 76%;
  padding: 11px 14px;
  border-radius: 16px;
  font-size: 13.5px;
  line-height: 1.65;
}
.msg.bot .msg-bubble {
  background: white;
  color: #1a1a2e;
  border-bottom-left-radius: 4px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.07);
}
.msg.user .msg-bubble {
  background: #0a1628;
  color: white;
  border-bottom-right-radius: 4px;
}
.msg-time {
  font-size: 10px;
  color: #aaa;
  margin-top: 3px;
  text-align: center;
}

/* ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
.typing-indicator {
  display: flex;
  align-items: center;
  gap: 8px;
  animation: msg-in 0.25s ease both;
}
.typing-dots {
  background: white;
  border-radius: 16px;
  border-bottom-left-radius: 4px;
  padding: 12px 16px;
  display: flex;
  gap: 5px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.07);
}
.typing-dot {
  width: 7px;
  height: 7px;
  background: #c0bdb8;
  border-radius: 50%;
  animation: dot-bounce 1.2s ease-in-out infinite;
}
.typing-dot:nth-child(2) { animation-delay: 0.18s; }
.typing-dot:nth-child(3) { animation-delay: 0.36s; }
@keyframes dot-bounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-6px); background: #e8a020; }
}

/* ã‚¿ã‚°ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹è¡¨ç¤ºï¼‰ */
.msg-tag {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 2px 7px;
  border-radius: 10px;
  margin-bottom: 4px;
  display: inline-block;
}
.tag-rule { background: #e8f5ee; color: #2d8a4e; }
.tag-ai   { background: #f0ebf8; color: #5a3d8a; }

/* FAQ ãƒ‘ãƒãƒ« */
.faq-panel {
  padding: 12px 16px;
  background: white;
  border-top: 1px solid #eee;
  flex-shrink: 0;
}
.faq-panel-title {
  font-size: 11px;
  font-weight: 700;
  color: #999;
  letter-spacing: 1.5px;
  margin-bottom: 10px;
  text-transform: uppercase;
}
.faq-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.faq-chip {
  background: #f3f2ef;
  border: 1px solid #e2ddd5;
  color: #1a1a2e;
  font-size: 12px;
  font-weight: 500;
  padding: 6px 11px;
  border-radius: 20px;
  cursor: pointer;
  transition: background 0.15s, border-color 0.15s, transform 0.1s;
  white-space: nowrap;
}
.faq-chip:hover {
  background: #0a1628;
  color: white;
  border-color: #0a1628;
  transform: translateY(-1px);
}
.faq-chip:active { transform: translateY(0); }

/* å…¥åŠ›ã‚¨ãƒªã‚¢ */
.chat-input-area {
  padding: 12px 14px;
  background: white;
  border-top: 1px solid #eeebe5;
  display: flex;
  gap: 8px;
  align-items: flex-end;
  flex-shrink: 0;
}
.chat-input {
  flex: 1;
  border: 1.5px solid #e2ddd5;
  border-radius: 22px;
  padding: 10px 16px;
  font-size: 13.5px;
  font-family: 'Noto Sans JP', sans-serif;
  outline: none;
  resize: none;
  line-height: 1.5;
  max-height: 80px;
  overflow-y: auto;
  transition: border-color 0.2s;
  color: #1a1a2e;
  background: #fafaf8;
}
.chat-input:focus { border-color: #0a1628; background: white; }
.chat-input::placeholder { color: #bbb; }
.chat-send-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: #0a1628;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: background 0.2s, transform 0.1s;
}
.chat-send-btn:hover { background: #1a3a6a; transform: scale(1.05); }
.chat-send-btn:active { transform: scale(0.95); }
.chat-send-btn svg { width: 18px; height: 18px; fill: white; }

/* åˆæœŸã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.welcome-msg {
  text-align: center;
  padding: 8px 0 4px;
}
.welcome-msg .w-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, #0a1628, #1a3a6a);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 10px;
  font-size: 22px;
  box-shadow: 0 4px 14px rgba(10,22,40,0.25);
}
.welcome-msg .w-title {
  font-size: 13px;
  font-weight: 700;
  color: #1a1a2e;
  margin-bottom: 4px;
}
.welcome-msg .w-sub {
  font-size: 12px;
  color: #999;
  line-height: 1.6;
}

/* ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
.msg-link-btn {
  display: inline-block;
  margin-top: 8px;
  background: #0a1628;
  color: white;
  font-size: 12px;
  font-weight: 600;
  padding: 7px 14px;
  border-radius: 20px;
  text-decoration: none;
  cursor: pointer;
  border: none;
  transition: background 0.15s;
}
.msg-link-btn:hover { background: #1a3a6a; }

/* ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—èª¬æ˜ãƒ‘ãƒãƒ« */
.proto-info {
  position: fixed;
  top: 60px;
  left: 24px;
  width: 260px;
  background: rgba(10,22,40,0.92);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(232,160,32,0.3);
  border-radius: 14px;
  padding: 20px;
  color: white;
  z-index: 9001;
  font-size: 12.5px;
  line-height: 1.7;
}
.proto-info h3 {
  font-size: 13px;
  font-weight: 700;
  color: #e8a020;
  margin-bottom: 12px;
  letter-spacing: 1px;
}
.proto-info .pi-item {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
  align-items: flex-start;
}
.proto-info .pi-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #e8a020;
  flex-shrink: 0;
  margin-top: 6px;
}
.proto-info .pi-tag {
  font-size: 10px;
  font-weight: 700;
  padding: 1px 6px;
  border-radius: 4px;
  margin-right: 4px;
}
.pi-rule { background: #e8f5ee; color: #2d8a4e; }
.pi-ai   { background: #f0ebf8; color: #5a3d8a; }

@media (max-width: 500px) {
  .chat-window { width: calc(100vw - 24px); right: 12px; bottom: 88px; height: 70vh; }
  .proto-info { display: none; }
}
</style>
</head>
<body>

<div class="prototype-label">ğŸ”§ UIãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— â€” ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ  AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</div>

<!-- ãƒ€ãƒŸãƒ¼ã‚µã‚¤ãƒˆèƒŒæ™¯ -->
<div class="site-bg">
  <nav class="dummy-nav">
    <div class="dummy-logo">id<span>HOME</span></div>
    <ul class="dummy-nav-links">
      <li><a href="#">å•†å“ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—</a></li>
      <li><a href="#">æ–½å·¥äº‹ä¾‹</a></li>
      <li><a href="#">åº—èˆ—ä¸€è¦§</a></li>
      <li><a href="#">ãŠå•ã„åˆã‚ã›</a></li>
    </ul>
  </nav>
  <div class="dummy-hero">
    <h1>å“è³ªã¨ä¾¡æ ¼ã«ã€<br><span>ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’ã€‚</span></h1>
    <p>ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ ã¯ã€åˆ†è­²ãƒ»æ³¨æ–‡ä½å®…ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ç·åˆçš„ãªä½ç’°å¢ƒå‰µé€ ä¼æ¥­ã¨ã—ã¦åœ°åŸŸç¤¾ä¼šã«è±Šã‹ãªæš®ã‚‰ã—ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
    <button class="dummy-btn">ç‰©ä»¶ã‚’æ¢ã™</button>
  </div>
</div>

<!-- ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—èª¬æ˜ -->
<div class="proto-info">
  <h3>ğŸ”§ ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—èª¬æ˜</h3>
  <div class="pi-item"><div class="pi-dot"></div><div>å³ä¸‹ã®ãƒãƒ–ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒãƒ£ãƒƒãƒˆãŒé–‹ãã¾ã™</div></div>
  <div class="pi-item"><div class="pi-dot"></div><div>FAQãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦è³ªå•ã‚’è©¦ã›ã¾ã™</div></div>
  <div class="pi-item">
    <div class="pi-dot"></div>
    <div>
      <span class="pi-tag pi-rule">å³å›ç­”</span> å®šå‹è³ªå•ã¯APIä¸ä½¿ç”¨ã§å³å›ç­”<br>
      <span class="pi-tag pi-ai">AIå›ç­”</span> è¤‡é›‘ãªè³ªå•ã¯AIãŒå›ç­”
    </div>
  </div>
  <div class="pi-item"><div class="pi-dot"></div><div>ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã§ã‚‚è³ªå•ã§ãã¾ã™</div></div>
</div>

<!-- â•â•â•â• ãƒãƒ–ãƒ«ãƒœã‚¿ãƒ³ â•â•â•â• -->
<div class="chat-bubble-btn" id="bubbleBtn" onclick="toggleChat()">
  <div class="chat-badge" id="chatBadge">1</div>
  <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
  </svg>
</div>

<!-- â•â•â•â• ãƒãƒ£ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ â•â•â•â• -->
<div class="chat-window" id="chatWindow">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="chat-header">
    <div class="chat-avatar">ğŸ </div>
    <div class="chat-header-info">
      <div class="chat-header-name">ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ  AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
      <div class="chat-header-status">â— ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ â€” ã™ãã«ãŠç­”ãˆã—ã¾ã™</div>
    </div>
    <button class="chat-close-btn" onclick="toggleChat()">âœ•</button>
  </div>

  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
  <div class="chat-messages" id="chatMessages">
    <div class="welcome-msg">
      <div class="w-icon">ğŸ </div>
      <div class="w-title">ä½ã¾ã„ã®ã”ç›¸è«‡ã€ãŠæ°—è»½ã«ã©ã†ã</div>
      <div class="w-sub">ä½å®…è³¼å…¥ãƒ»ç‰©ä»¶ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆãªã©<br>ãªã‚“ã§ã‚‚ãŠèããã ã•ã„</div>
    </div>
  </div>

  <!-- FAQãƒ‘ãƒãƒ« -->
  <div class="faq-panel" id="faqPanel">
    <div class="faq-panel-title">ã‚ˆãã‚ã‚‹è³ªå•</div>
    <div class="faq-chips">
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ“ è¿‘ãã®ãƒ¢ãƒ‡ãƒ«ãƒã‚¦ã‚¹ã¯ï¼Ÿ')">ğŸ“ è¿‘ãã®ãƒ¢ãƒ‡ãƒ«ãƒã‚¦ã‚¹ã¯ï¼Ÿ</div>
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ’° ä¾¡æ ¼å¸¯ã‚’æ•™ãˆã¦ãã ã•ã„')">ğŸ’° ä¾¡æ ¼å¸¯ã‚’æ•™ãˆã¦ãã ã•ã„</div>
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ¡ ãƒªãƒŠãƒ¼ã‚¸ãƒ¥ã¨ã¯ï¼Ÿ')">ğŸ¡ ãƒªãƒŠãƒ¼ã‚¸ãƒ¥ã¨ã¯ï¼Ÿ</div>
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ“… æ¥åº—äºˆç´„ã—ãŸã„')">ğŸ“… æ¥åº—äºˆç´„ã—ãŸã„</div>
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ“„ è³‡æ–™è«‹æ±‚ã—ãŸã„')">ğŸ“„ è³‡æ–™è«‹æ±‚ã—ãŸã„</div>
      <div class="faq-chip" onclick="sendFaq(this, 'ğŸ”§ ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦')">ğŸ”§ ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦</div>
    </div>
  </div>

  <!-- å…¥åŠ›ã‚¨ãƒªã‚¢ -->
  <div class="chat-input-area">
    <textarea class="chat-input" id="chatInput" placeholder="ã”è³ªå•ã‚’ã©ã†ãâ€¦" rows="1"
      onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
    <button class="chat-send-btn" onclick="sendMessage()">
      <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
    </button>
  </div>
</div>

<script>
// â”€â”€ ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹å›ç­”ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ â”€â”€
const ruleBase = {
  'ãƒ¢ãƒ‡ãƒ«ãƒã‚¦ã‚¹': {
    tag: 'rule',
    text: 'å…¨å›½ã«åº—èˆ—ãƒ»ãƒ¢ãƒ‡ãƒ«ãƒã‚¦ã‚¹ãŒã”ã–ã„ã¾ã™ã€‚\n\næœ€å¯„ã‚Šã®åº—èˆ—ã¯ã“ã¡ã‚‰ã‹ã‚‰ã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã€‚',
    link: { label: 'â†’ åº—èˆ—ä¸€è¦§ã‚’è¦‹ã‚‹', url: 'https://idhome.co.jp/stores/' }
  },
  'æ¥åº—äºˆç´„': {
    tag: 'rule',
    text: 'æ¥åº—äºˆç´„ã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§24æ™‚é–“å—ã‘ä»˜ã‘ã¦ãŠã‚Šã¾ã™ã€‚ã”å¸Œæœ›ã®æ—¥æ™‚ãƒ»åº—èˆ—ã‚’ãŠé¸ã³ãã ã•ã„ã€‚',
    link: { label: 'â†’ æ¥åº—äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ã¸', url: 'https://idhome.co.jp/inquiry/modelhouse_form/' }
  },
  'è³‡æ–™è«‹æ±‚': {
    tag: 'rule',
    text: 'ã‚«ã‚¿ãƒ­ã‚°ãƒ»è³‡æ–™ã®ã”è«‹æ±‚ã¯ã“ã¡ã‚‰ã‹ã‚‰ç„¡æ–™ã§ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚',
    link: { label: 'â†’ è³‡æ–™è«‹æ±‚ãƒ•ã‚©ãƒ¼ãƒ ã¸', url: 'https://idhome.co.jp/inquiry/catalog/' }
  },
  'ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆ': {
    tag: 'rule',
    text: 'å…¥å±…å¾Œã®ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆã«ã¤ã„ã¦ã¯å°‚ç”¨ã®çª“å£ã‚’ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ã€‚å®šæœŸç‚¹æ¤œãƒ»ä¿®ç¹•ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³å·¥äº‹ãªã©ã€ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ã€‚',
    link: { label: 'â†’ ã‚¢ãƒ•ã‚¿ãƒ¼ã‚µãƒãƒ¼ãƒˆã¸', url: 'https://idhome.co.jp/business/after_service/' }
  },
  'å–¶æ¥­æ™‚é–“': {
    tag: 'rule',
    text: 'å„åº—èˆ—ã®å–¶æ¥­æ™‚é–“ã¯åº—èˆ—ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚è©³ç´°ã¯åº—èˆ—ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚ˆã‚Šã”ç¢ºèªãã ã•ã„ã€‚\n\nä¸€èˆ¬çš„ã«ã¯ 10:00ã€œ18:00 ã§ã®å–¶æ¥­ãŒå¤šã„ã§ã™ã€‚',
    link: { label: 'â†’ åº—èˆ—ä¸€è¦§ã‚’è¦‹ã‚‹', url: 'https://idhome.co.jp/stores/' }
  },
};

// AIå›ç­”ï¼ˆè¤‡é›‘ãªè³ªå•ï¼‰
const aiResponses = {
  'ãƒªãƒŠãƒ¼ã‚¸ãƒ¥': 'ãƒªãƒŠãƒ¼ã‚¸ãƒ¥ï¼ˆLiGNAGEï¼‰ã¯ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ ã®ä¸»åŠ›ãƒ–ãƒ©ãƒ³ãƒ‰ã§ã™ã€‚\n\nâ€¢ **ãƒªãƒŠãƒ¼ã‚¸ãƒ¥ ãƒã‚¯ã‚¹ã‚¸ãƒ¼**ï¼šæ–°ç¯‰åˆ†è­²ä½å®…ã€‚é«˜å“è³ªãªè¨­å‚™ã¨åˆç†çš„ãªä¾¡æ ¼ãŒç‰¹å¾´\nâ€¢ **ãƒªãƒŠãƒ¼ã‚¸ãƒ¥ ã‚ªãƒ¼ãƒ€ãƒ¼**ï¼šæ³¨æ–‡ä½å®…ã€‚ãŠå®¢æ§˜ã®ã”è¦æœ›ã«åˆã‚ã›ãŸè‡ªç”±è¨­è¨ˆ\n\nã©ã¡ã‚‰ã‚‚ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ ã®ã€Œå“è³ªã¨ä¾¡æ ¼ã«ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’ã€ã®ç†å¿µã®ã‚‚ã¨è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚',
  'ä¾¡æ ¼': 'ä½å®…ã®ä¾¡æ ¼ã¯ç«‹åœ°ãƒ»åºƒã•ãƒ»ä»•æ§˜ã«ã‚ˆã‚Šç•°ãªã‚Šã¾ã™ãŒã€ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ ã®åˆ†è­²ä½å®…ã¯**ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã•**ãŒç‰¹å¾´ã§ã™ã€‚\n\nè©³ã—ã„ä¾¡æ ¼å¸¯ã¯ç‰©ä»¶æ¤œç´¢ãƒšãƒ¼ã‚¸ã‹ã‚‰ã”ç¢ºèªã„ãŸã ãã‹ã€ãŠè¿‘ãã®ãƒ¢ãƒ‡ãƒ«ãƒã‚¦ã‚¹ã§ã‚¹ã‚¿ãƒƒãƒ•ã«ã”ç›¸è«‡ãã ã•ã„ã€‚',
  'å¹³å±‹': 'ã‚¢ã‚¤ãƒ‡ã‚£ãƒ›ãƒ¼ãƒ ã®å¹³å±‹ã¯ã€ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼ã§ç”Ÿæ´»å‹•ç·šãŒã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã¾ã¨ã¾ã£ãŸäººæ°—ã®å•†å“ã§ã™ã€‚\n\nã”å®¶æ—æ§‹æˆã‚„ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã«åˆã‚ã›ãŸãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã§ãã¾ã™ã€‚è©³ã—ãã¯å•†å“ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
};

// â”€â”€ çŠ¶æ…‹ç®¡ç† â”€â”€
let isOpen = false;
let isTyping = false;

function toggleChat() {
  isOpen = !isOpen;
  const win = document.getElementById('chatWindow');
  const btn = document.getElementById('bubbleBtn');
  const badge = document.getElementById('chatBadge');
  win.classList.toggle('open', isOpen);
  btn.classList.toggle('open', isOpen);
  badge.classList.add('hidden');
  if (isOpen) {
    setTimeout(() => document.getElementById('chatInput').focus(), 350);
  }
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text || isTyping) return;
  input.value = '';
  autoResize(input);
  addUserMessage(text);
  hideFaqPanel();
  processResponse(text);
}

function sendFaq(el, text) {
  if (isTyping) return;
  addUserMessage(text);
  hideFaqPanel();
  processResponse(text);
}

function hideFaqPanel() {
  const panel = document.getElementById('faqPanel');
  panel.style.maxHeight = panel.offsetHeight + 'px';
  requestAnimationFrame(() => {
    panel.style.transition = 'max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease';
    panel.style.maxHeight = '0';
    panel.style.opacity = '0';
    panel.style.paddingTop = '0';
    panel.style.paddingBottom = '0';
  });
}

// å¿œç­”å‡¦ç†
function processResponse(text) {
  isTyping = true;

  // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ¤å®š
  const ruleKey = Object.keys(ruleBase).find(k => text.includes(k));
  // AIåˆ¤å®š
  const aiKey = Object.keys(aiResponses).find(k => text.includes(k));

  const delay = ruleKey ? 500 : 1800; // ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã¯å³å›ç­”
  const tag = ruleKey ? 'rule' : 'ai';

  showTyping(tag);

  setTimeout(() => {
    removeTyping();
    if (ruleKey) {
      const r = ruleBase[ruleKey];
      addBotMessage(r.text, 'rule', r.link);
    } else if (aiKey) {
      addBotMessage(aiResponses[aiKey], 'ai');
    } else {
      addBotMessage('ã”è³ªå•ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚è©³ã—ã„å†…å®¹ã¯ã‚¹ã‚¿ãƒƒãƒ•ãŒç›´æ¥ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚\n\nãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„ã€‚', 'ai', { label: 'â†’ ãŠå•ã„åˆã‚ã›ã¯ã“ã¡ã‚‰', url: 'https://idhome.co.jp/inquiry/' });
    }
    isTyping = false;
  }, delay);
}

function addUserMessage(text) {
  const msgs = document.getElementById('chatMessages');
  const now = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
  const el = document.createElement('div');
  el.className = 'msg user';
  el.innerHTML = `
    <div class="msg-avatar" style="background:#1a3a6a;color:white;font-size:12px">ã‚ãªãŸ</div>
    <div>
      <div class="msg-bubble">${escHtml(text)}</div>
      <div class="msg-time">${now}</div>
    </div>`;
  msgs.appendChild(el);
  scrollBottom();
}

function addBotMessage(text, tag, link) {
  const msgs = document.getElementById('chatMessages');
  const now = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
  const tagLabel = tag === 'rule'
    ? '<span class="msg-tag tag-rule">âš¡ å³å›ç­”</span>'
    : '<span class="msg-tag tag-ai">ğŸ¤– AIå›ç­”</span>';
  const linkHtml = link
    ? `<br><button class="msg-link-btn" onclick="window.open('${link.url}','_blank')">${link.label}</button>`
    : '';
  const formatted = escHtml(text).replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
  const el = document.createElement('div');
  el.className = 'msg bot';
  el.innerHTML = `
    <div class="msg-avatar">ğŸ </div>
    <div>
      ${tagLabel}
      <div class="msg-bubble">${formatted}${linkHtml}</div>
      <div class="msg-time">${now}</div>
    </div>`;
  msgs.appendChild(el);
  scrollBottom();
}

function showTyping(tag) {
  const msgs = document.getElementById('chatMessages');
  const el = document.createElement('div');
  el.id = 'typingIndicator';
  el.className = 'typing-indicator';
  const label = tag === 'rule'
    ? '<span class="msg-tag tag-rule" style="display:block;margin-bottom:4px">âš¡ å³å›ç­”</span>'
    : '<span class="msg-tag tag-ai" style="display:block;margin-bottom:4px">ğŸ¤– AIå›ç­”</span>';
  el.innerHTML = `
    <div class="msg-avatar">ğŸ </div>
    <div>
      ${label}
      <div class="typing-dots">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>`;
  msgs.appendChild(el);
  scrollBottom();
}

function removeTyping() {
  const el = document.getElementById('typingIndicator');
  if (el) el.remove();
}

function scrollBottom() {
  const msgs = document.getElementById('chatMessages');
  msgs.scrollTop = msgs.scrollHeight;
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 80) + 'px';
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
